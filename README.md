{
  "readme": "# Luma - Cross-Chain Bridge Event Oracle\n\nThis repository contains a Python-based simulation of an event-listening oracle, a critical component in cross-chain bridge architectures. It is designed to demonstrate the architectural patterns and logic involved in monitoring a source blockchain for specific events and triggering corresponding actions on a destination blockchain.\n\n## Concept\n\nA cross-chain bridge allows users to transfer assets or data from one blockchain (e.g., Ethereum) to another (e.g., Polygon). A common mechanism for this is \"lock-and-mint\":\n\n1.  **Lock**: A user locks tokens in a smart contract on the source chain. This action emits an event, for example, `TokensLocked`.\n2.  **Verify**: A network of off-chain oracles (or validators) listens for this `TokensLocked` event.\n3.  **Mint**: Upon detecting and verifying the event, an oracle submits a transaction to a smart contract on the destination chain to mint an equivalent amount of \"wrapped\" tokens for the user.\n\nA `TokensLocked` event in a Solidity smart contract might look like this:\n\n```solidity\nevent TokensLocked(\n    address indexed user,\n    address indexed token,\n    uint256 amount,\n    uint256 destinationChainId,\n    bytes32 indexed nonce\n);\n```\n\nThis `luma` script simulates the core logic of one such oracle. It connects to a source chain, listens for `TokensLocked` events, and then simulates the process of building, signing, and sending a `mintTokens` transaction on the destination chain.\n\n## Code Architecture\n\nThe script is designed with a clear separation of concerns, using several classes to handle distinct responsibilities:\n\n-   `ConfigManager`: Responsible for loading and validating all necessary configuration from a `.env` file, such as RPC endpoints, contract addresses, and private keys. This keeps configuration separate from the application logic.\n\n-   `ChainConnector`: A wrapper around `web3.py` that manages the connection to a single blockchain. It handles connection setup, middleware injection (for PoA chains), and provides simple methods for interacting with the chain (e.g., getting the latest block).\n\n-   `HealthMonitor`: A utility class that uses the `requests` library to periodically check the health and responsiveness of the configured RPC endpoints. This is crucial for ensuring the reliability of the oracle.\n\n-   `EventListener`: The heart of the listening mechanism. It uses a `ChainConnector` to connect to the source chain, sets up a filter for the target event (`TokensLocked`), and polls the chain for new event logs.\n\n-   `TransactionProcessor`: This class receives events detected by the `EventListener`. It uses a `ChainConnector` for the destination chain to construct and sign the corresponding `mintTokens` transaction. **For safety and simplicity, it only simulates this process by logging the transaction details instead of broadcasting it.**\n\n-   `CrossChainBridgeOracle`: The main orchestrator class. It initializes all other components, integrates them, and runs the main application loop, which includes event polling and periodic health checks.\n\n### Interaction Flow\n\nThe `CrossChainBridgeOracle` class orchestrates the components. The `EventListener` polls the source chain for events and passes them to the `TransactionProcessor`, which prepares the corresponding transaction for the destination chain.\n\n```\n+--------------------------+\n| CrossChainBridgeOracle   | (Main Orchestrator)\n+--------------------------+\n           |\n   +-------+---------+\n   | (Initializes)   | (Initializes)\n   v                 v\n+--------------------+      (Events)     +----------------------+\n| EventListener      | ---------------> | TransactionProcessor |\n+--------------------+                  +----------------------+\n        | Uses                               | Uses\n        v                                    v\n+----------------------+              +----------------------+\n| ChainConnector (Src) |              | ChainConnector (Dst) |\n+----------------------+              +----------------------+\n```\n\n## How It Works\n\n1.  **Initialization**: The `CrossChainBridgeOracle` is instantiated. It immediately creates a `ConfigManager` to load settings from the `.env` file.\n\n2.  **Connection Setup**: Two instances of `ChainConnector` are created: one for the source chain and one for the destination chain, using the RPC URLs from the config.\n\n3.  **Component Assembly**: The `EventListener` is set up with the source chain connector and bridge contract address. The `TransactionProcessor` is set up with the destination chain connector and the oracle's private key.\n\n4.  **Main Loop**: The `run()` method starts an infinite loop:\n    a.  **Health Check**: Periodically, the `HealthMonitor` sends a simple request to both RPC endpoints to ensure they are online.\n    b.  **Event Polling**: The `EventListener` polls the source chain for new `TokensLocked` events that have occurred since the last check.\n    c.  **Event Processing**: If any events are found, they are passed one by one to the `TransactionProcessor`.\n    d.  **Transaction Simulation**: For each event, the `TransactionProcessor` builds a `mintTokens` transaction, signs it with the oracle's (dummy) private key, and logs the details of what *would* be sent to the destination chain.\n    e.  **Sleep**: The loop waits for a configured interval (e.g., 15 seconds) before repeating.\n\n## Prerequisites\n\n*   Python 3.8+\n*   An `.env` file with your configuration (see Usage Example).\n*   Dependencies listed in `requirements.txt`.\n\n## Usage Example\n\n1.  **Clone the repository and install dependencies:**\n\n    ```bash\n    git clone https://github.com/your-username/luma.git\n    cd luma\n    pip install -r requirements.txt\n    ```\n\n2.  **Create a configuration file:**\n\n    Create a file named `.env` in the root directory of the project and populate it with the necessary details. You can use public RPC endpoints for testnets like Sepolia or Polygon Mumbai.\n\n    **Example `.env` file:**\n    ```env\n    # Source Chain (e.g., Polygon Mumbai)\n    SOURCE_CHAIN_RPC=\"https://rpc.ankr.com/polygon_mumbai\"\n    SOURCE_BRIDGE_ADDRESS=\"0x2cf831b1A0b52479561571CE3452a202154c8612\" # Use any valid address for simulation\n\n    # Destination Chain (e.g., Sepolia Testnet)\n    DESTINATION_CHAIN_RPC=\"https://rpc.sepolia.org\"\n    DESTINATION_BRIDGE_ADDRESS=\"0x8A594fC2145524458fAc6b1525164Ab725b84803\" # Use any valid address for simulation\n\n    # Oracle's key - IMPORTANT: FOR SIMULATION ONLY. DO NOT USE A REAL KEY WITH FUNDS.\n    ORACLE_PRIVATE_KEY=\"0x0000000000000000000000000000000000000000000000000000000000000001\"\n    ```\n\n3.  **Run the script:**\n\n    ```bash\n    python main.py\n    ```\n\n4.  **Observe the output:**\n\n    The script will start logging its activities. It will connect to the chains and begin polling. If a `TokensLocked` event is emitted on the `SOURCE_BRIDGE_ADDRESS` while the script is running, you will see output similar to this:\n\n    ```\n    2023-10-27 10:30:00,123 - INFO - [LumaBridgeOracle] - Initializing Luma Cross-Chain Bridge Oracle...\n    2023-10-27 10:30:00,124 - INFO - [LumaBridgeOracle] - Configuration loaded and validated successfully.\n    2023-10-27 10:30:01,500 - INFO - [LumaBridgeOracle] - Successfully connected to SourceChain (Chain ID: 80001).\n    2023-10-27 10:30:02,800 - INFO - [LumaBridgeOracle] - Successfully connected to DestinationChain (Chain ID: 11155111).\n    2023-10-27 10:30:02,801 - INFO - [LumaBridgeOracle] - EventListener created for 'TokensLocked' event at 0x2cf831b1A0b52479561571CE3452a202154c8612\n    2023-10-27 10:30:02,802 - INFO - [LumaBridgeOracle] - TransactionProcessor initialized for destination contract 0x8A594fC2145524458fAc6b1525164Ab725b84803.\n    2023-10-27 10:30:02,803 - INFO - [LumaBridgeOracle] - Oracle Address: 0x7E5F4552091A69125d5DfCb7b8C2659029395Bdf\n    2023-10-27 10:30:02,803 - INFO - [LumaBridgeOracle] - Oracle is now running. Polling for events...\n    ...\n    2023-10-27 10:31:15,200 - INFO - [LumaBridgeOracle] - Found 1 new 'TokensLocked' event(s).\n    2023-10-27 10:31:15,201 - INFO - [LumaBridgeOracle] - Processing event with nonce 12345: Mint 1000000000000000000 tokens for 0xRecipientAddress...\n    2023-10-27 10:31:15,500 - INFO - [LumaBridgeOracle] - [SIMULATION] Transaction to mint tokens has been signed.\n    2023-10-27 10:31:15,501 - INFO - [LumaBridgeOracle] -   - To: 0x8A594fC2145524458fAc6b1525164Ab725b84803\n    2023-10-27 10:31:15,501 - INFO - [LumaBridgeOracle] -   - From: 0x7E5F4552091A69125d5DfCb7b8C2659029395Bdf\n    2023-10-27 10:31:15,502 - INFO - [LumaBridgeOracle] -   - Nonce: 56\n    2023-10-27 10:31:15,502 - INFO - [LumaBridgeOracle] -   - Signed TX Hash (simulated): 0xab...cd\n    2023-10-27 10:31:15,503 - INFO - [LumaBridgeOracle] - [DB SIMULATION] Checking if nonce 12345 has been processed... Assumed not processed.\n    ```"
}